Dưới đây là tài liệu API cho các service Cart, Inventory, Order, và Payment dựa trên các file bạn đã cung cấp.


🔐 Yêu Cầu Chung: Xác Thực


Tất cả các API endpoint được đánh dấu là (Yêu cầu xác thực) đều BẮT BUỘC phải được gọi với header Authorization chứa JWT token của người dùng đã đăng nhập.
Header:






Authorization: Bearer <your_jwt_token>

________________


🛒 Cart Service (cart-service)


Service này quản lý giỏ hàng của người dùng.


1. Lấy Giỏ Hàng Hiện Tại


* (Yêu cầu xác thực)
* URL: GET /my-cart
* Method: GET
* Mô tả: Lấy danh sách tất cả các sản phẩm trong giỏ hàng của người dùng hiện tại (xác định bằng JWT token).


Request Body Example


(Không có)


Success Response Example (200 OK)


Trả về một mảng các CartResponse. Mỗi CartResponse bao gồm thông tin sản phẩm và số lượng tồn kho.


JSON




{
 "message": "Cart retrieved successfully",
 "result": [
   {
     "id": "cart-item-uuid-1",
     "productResponse": {
       "id": "book-uuid-1",
       "name": "Sách Lập Trình ABC",
       "basePrice": 150000.0,
       "salePrice": 120000.0,
       "thumbnail": "http://example.com/image.png",
       "slug": "sach-lap-trinh-abc"
     },
     "quantity": 2,
     "stock": 50
   },
   {
     "id": "cart-item-uuid-2",
     "productResponse": {
       "id": "book-uuid-2",
       "name": "Sách XYZ",
       "basePrice": 200000.0,
       "salePrice": null,
       "thumbnail": "http://example.com/image2.png",
       "slug": "sach-xyz"
     },
     "quantity": 1,
     "stock": 10
   }
 ]
}

________________


2. Thêm/Cập Nhật Sản Phẩm Trong Giỏ Hàng


* (Yêu cầu xác thực)
* URL: POST /my-cart
* Method: POST
* Mô tả: Thêm một sản phẩm vào giỏ hàng hoặc cập nhật số lượng nếu sản phẩm đã tồn tại.


Request Body Example (application/json)




JSON




{
 "productId": "book-uuid-1",
 "quantity": 1
}



Success Response Example (200 OK)


Trả về CartResponse cho sản phẩm vừa được thêm/cập nhật.


JSON




{
 "message": "Product added to cart",
 "result": {
   "id": "cart-item-uuid-1",
   "productResponse": {
     "id": "book-uuid-1",
     "name": "Sách Lập Trình ABC",
     "basePrice": 150000.0,
     "salePrice": 120000.0,
     "thumbnail": "http://example.com/image.png",
     "slug": "sach-lap-trinh-abc"
   },
   "quantity": 1,
   "stock": 50
 }
}

________________


3. Xóa Sản Phẩm Khỏi Giỏ Hàng


* (Yêu cầu xác thực)
* URL: DELETE /my-cart/{productId}
* Method: DELETE
* Mô tả: Xóa một sản phẩm cụ thể (productId) khỏi giỏ hàng.


Request Body Example


(Không có)


Success Response Example (200 OK)




JSON




{
 "message": "Product removed from cart",
 "result": null
}

________________


4. Xóa Sạch Giỏ Hàng


* (Yêu cầu xác thực)
* URL: DELETE /my-cart
* Method: DELETE
* Mô tả: Xóa tất cả các sản phẩm khỏi giỏ hàng của người dùng.


Request Body Example


(Không có)


Success Response Example (200 OK)




JSON




{
 "message": "Cart cleared successfully",
 "result": null
}

________________


📦 Inventory Service (inventory-service)


Service này quản lý số lượng tồn kho.


1. Lấy Số Lượng Tồn Kho


* URL: GET /inventory/{bookId}
* Method: GET
* Mô tả: Lấy số lượng tồn kho hiện tại của một bookId cụ thể. (API này không yêu cầu xác thực).


Request Body Example


(Không có)


Success Response Example (200 OK)


Trả về một đối tượng InventoryResponse.


JSON




{
 "message": "Get stock successfully",
 "result": {
   "bookId": "book-uuid-1",
   "quantity": 50
 }
}



Error Response Example (Hết hàng hoặc không tìm thấy) (404 Not Found)




JSON




{
 "message": "Book not found or out of stock",
 "result": null
}

________________


💳 Order Service (order-service)


Service này xử lý việc tạo đơn hàng và bắt đầu quy trình thanh toán.


1. Tạo Đơn Hàng (Checkout)


* (Yêu cầu xác thực)
* URL: POST /orders/checkout
* Method: POST
* Mô tả: Tạo một đơn hàng mới từ giỏ hàng hiện tại của người dùng. Đây là API bước 1 của quy trình thanh toán.


Request Body Example (application/json)




JSON




{
 "shippingAddress": {
   "street": "123 Đường ABC",
   "city": "Đà Nẵng",
   "state": "Sơn Trà",
   "postalCode": "550000",
   "country": "Việt Nam",
   "phone": "0905123456"
 },
 "note": "Giao hàng vào giờ hành chính."
}



Success Response Example (200 OK)


Trả về thông tin đơn hàng vừa tạo với orderStatus: "PENDING" và paymentUrl: null. Bạn phải lưu lại id (Order ID) từ response này.


JSON




{
 "message": "Order created successfully, processing.",
 "result": {
   "id": "a1b2c3d4-e5f6-7890-g1h2-i3j4k5l6m7n8",
   "orderStatus": "PENDING",
   "userId": "user-uuid-from-token",
   "ipAddress": null,
   "paymentUrl": null,
   "totalAmount": 150000.0,
   "shippingAddress": { ... },
   "note": "Giao hàng vào giờ hành chính.",
   "items": [ ... ],
   "createdAt": "2025-11-15T05:00:00.000Z",
   "updatedAt": "2025-11-15T05:00:00.000Z"
 }
}

________________


2. Lấy URL Thanh Toán


* (Yêu cầu xác thực)
* URL: GET /orders/{orderId}/payment-url
* Method: GET
* Mô tả: Lấy URL thanh toán VNPay cho đơn hàng. Đây là API bước 2 của quy trình.


Lưu ý quan trọng


Đây là API bất đồng bộ. Bạn phải liên tục gọi (poll) API này sau khi đã gọi API POST /orders/checkout thành công (ví dụ: gọi mỗi 2 giây) cho đến khi nhận được URL.


Success Response Example (Khi URL CHƯA Sẵn Sàng) (200 OK)


Bạn tiếp tục đợi và gọi lại (poll).


JSON




{
 "message": null,
 "result": null
}



Success Response Example (Khi URL ĐÃ Sẵn Sàng) (200 OK)


Bạn nhận được link, dừng polling và chuyển hướng người dùng đến URL này.


JSON




{
 "message": null,
 "result": "https://sandbox.vnpayment.vn/paymentv2/vpcpay.html?vnp_Amount=..."
}

________________


💸 Payment Service (payment-service)


Frontend KHÔNG trực tiếp gọi các API này. Đây là tài liệu để bạn tham khảo cách luồng thanh toán hoạt động.


1. VNPay Callback


* URL: GET /payment/vnpay-callback
* Method: GET
* Mô tả: Sau khi người dùng hoàn tất thanh toán (hoặc hủy) trên cổng VNPay, VNPay sẽ tự động chuyển hướng (redirect) trình duyệt của người dùng về URL này.
* Hành vi Backend: Backend xử lý các tham số từ VNPay (ví dụ: vnp_ResponseCode) và sau đó thực hiện một chuyển hướng 302 (redirect) trình duyệt của người dùng về một URL phía Frontend (ví dụ: https://your-frontend.com/payment-result?orderId=...&status=...).
* Lưu ý cho Frontend: Bạn cần xây dựng một trang (ví dụ: /payment-result) để đón người dùng quay về và hiển thị thông báo "Thanh toán thành công/thất bại" dựa trên các query params mà backend đính kèm.


2. VNPay IPN (Instant Payment Notification)


* URL: GET /payment/vnpay-ipn
* Method: GET
* Mô tả: Đây là một cuộc gọi server-to-server (ẩn) mà VNPay thực hiện để xác nhận trạng thái cuối cùng của giao dịch. Đây mới là nơi backend tin cậy để cập nhật trạng thái PAID / FAILED cho đơn hàng.
* Lưu ý cho Frontend: Bạn không cần quan tâm đến API này. Nó đảm bảo rằng ngay cả khi người dùng tắt trình duyệt sau khi thanh toán, đơn hàng vẫn sẽ được cập nhật chính xác.